version: '3.8'

services:
  # Nombre del servicio de la API de .NET
  netapi:
    # 游 REFERENCIA A TU IMAGEN FINAL EN DOCKER HUB 游
    image: juandavidbarr/net-api-finanzas:latest
    
    container_name: netapi_gestor_finanzas
    
    # 游 OPTIMIZACI칍N DE RECURSOS (Importante para tu VPS de 4GB)
    # Limita el uso de RAM a un m치ximo de 512 MB. Ajusta seg칰n sea necesario.
    deploy:
      resources:
        limits:
          memory: 512M
    
    # Asegura que el contenedor se inicie autom치ticamente despu칠s de un fallo o reinicio del VPS.
    restart: always
    
    # Mapeo de puertos: El puerto interno 8080 del contenedor se expone al puerto 5001 del host VPS.
    # Nginx configurado en el VPS usar치 este puerto (5001) para el proxy inverso.
    ports:
      - "5001:8080"
    
    # 丘뙖잺 VARIABLES DE ENTORNO
    # Aqu칤 es donde configuras la conexi칩n a tu base de datos PostgreSQL ya existente en el VPS.
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      # Si la base de datos corre directamente en el host (fuera de docker-compose), usa 'host.docker.internal'
      # o la IP del host si el contenedor no puede resolver 'host.docker.internal' (com칰n en Linux).
      # Si la DB es otro contenedor, usa el nombre del servicio (Ej: 'db_postgres')
      ConnectionStrings__DefaultConnection: Host=db;Database=riwiwallet_db;Username=riwi_user;Password=J9YoXTAy77bVPxwMtArRHfXDC

# NOTA: En la mayor칤a de los VPS Linux, si la DB est치 corriendo nativamente en el host, 
# la forma m치s robusta de conectarse desde el contenedor es usar la IP interna de la puerta de enlace
# o configurar un puerto compartido. Pero para empezar, prueba con 'host.docker.internal'. 
# Si falla, deber치s usar la IP interna del host (e.g., 172.17.0.1 o similar, que es la IP por defecto del bridge Docker).